
Skip to content
Pull requests
Issues
Marketplace
Explore
@chris-pateman
hmcts /
pip-shared-infrastructures
Public
generated from hmcts/spring-boot-template

Code
Issues
Pull requests 2
Actions
Projects
Wiki
Security
Insights

    Settings

pip-shared-infrastructures/Jenkinsfile_parameterized
@chris-pateman
chris-pateman convert b2c wording to ad
Latest commit 3671a3b yesterday
History
2 contributors
@chris-pateman
@adamtodd0
48 lines (41 sloc) 929 Bytes
#!groovy
//noinspection GroovyUnusedAssignment
@Library("Infrastructure") _

def product = "pip"
def component = "shared-infrastructure"

def setupTerraformSecret() {

  def bootstap_env = "sbox"

  azureKeyVault(
    keyVaultURL: "https://pip-bootstrap-${bootstap_env}-kv.vault.azure.net/",
    secrets: [
      secret('b2c-client-secret', 'AD_CLIENT_SECRET')
    ]) {
    env.TF_VAR_AD_CLIENT_SECRET = "${AD_CLIENT_SECRET}"
  }
}

static Map<String, Object> secret(String secretName, String envVariable) {
  [
    $class     : 'AzureKeyVaultSecret',
    secretType : 'Secret',
    name       : secretName,
    envVariable: envVariable
  ]
}

withParameterizedInfraPipeline(product, "sbox", "sbox", component) {

 onMaster() {
    env.ENV = 'stg'
  }
  onPR() {
    env.ENV = 'dev'
  }
  onDemo {
    env.ENV = 'demo'
  }
  onPerftest {
    env.ENV = 'perftest'
  }
  onIthc {
    env.ENV = 'ithc'
  }
  setupTerraformSecret()
}
